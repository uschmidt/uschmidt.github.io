!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.dashjs=t():e.dashjs=t()}(window,(function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/dist/",n(n.s=71)}({1:function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.init()}var t,n,i;return t=e,(n=[{key:"init",value:function(){this.STREAM="stream",this.VIDEO="video",this.AUDIO="audio",this.TEXT="text",this.MUXED="muxed",this.IMAGE="image",this.STPP="stpp",this.TTML="ttml",this.VTT="vtt",this.WVTT="wvtt",this.ABR_STRATEGY_DYNAMIC="abrDynamic",this.ABR_STRATEGY_BOLA="abrBola",this.ABR_STRATEGY_L2A="abrL2A",this.ABR_STRATEGY_LoLP="abrLoLP",this.ABR_STRATEGY_THROUGHPUT="abrThroughput",this.ABR_FETCH_THROUGHPUT_CALCULATION_DOWNLOADED_DATA="abrFetchThroughputCalculationDownloadedData",this.ABR_FETCH_THROUGHPUT_CALCULATION_MOOF_PARSING="abrFetchThroughputCalculationMoofParsing",this.ABR_FETCH_THROUGHPUT_CALCULATION_AAST="abrFetchThroughputCalculationAAST",this.LIVE_CATCHUP_MODE_DEFAULT="liveCatchupModeDefault",this.LIVE_CATCHUP_MODE_LOLP="liveCatchupModeLoLP",this.MOVING_AVERAGE_SLIDING_WINDOW="slidingWindow",this.MOVING_AVERAGE_EWMA="ewma",this.BAD_ARGUMENT_ERROR="Invalid Arguments",this.MISSING_CONFIG_ERROR="Missing config parameter(s)",this.TRACK_SWITCH_MODE_ALWAYS_REPLACE="alwaysReplace",this.TRACK_SWITCH_MODE_NEVER_REPLACE="neverReplace",this.TRACK_SELECTION_MODE_FIRST_TRACK="firstTrack",this.TRACK_SELECTION_MODE_HIGHEST_BITRATE="highestBitrate",this.TRACK_SELECTION_MODE_HIGHEST_EFFICIENCY="highestEfficiency",this.TRACK_SELECTION_MODE_WIDEST_RANGE="widestRange",this.TRACK_SELECTION_MODE_HIGHEST_SELECTION_PRIORITY="highestSelectionPriority",this.CMCD_MODE_QUERY="query",this.CMCD_MODE_HEADER="header",this.LOCATION="Location",this.INITIALIZE="initialize",this.TEXT_SHOWING="showing",this.TEXT_HIDDEN="hidden",this.CC1="CC1",this.CC3="CC3",this.UTF8="utf-8",this.SCHEME_ID_URI="schemeIdUri",this.START_TIME="starttime",this.SERVICE_DESCRIPTION_LL_SCHEME="urn:dvb:dash:lowlatency:scope:2019",this.SUPPLEMENTAL_PROPERTY_LL_SCHEME="urn:dvb:dash:lowlatency:critical:2019",this.XML="XML",this.ARRAY_BUFFER="ArrayBuffer",this.DVB_REPORTING_URL="dvb:reportingUrl",this.DVB_PROBABILITY="dvb:probability",this.VIDEO_ELEMENT_READY_STATES={HAVE_NOTHING:0,HAVE_METADATA:1,HAVE_CURRENT_DATA:2,HAVE_FUTURE_DATA:3,HAVE_ENOUGH_DATA:4}}}])&&r(t.prototype,n),i&&r(t,i),e}());t.a=i},14:function(e,t,n){"use strict";var r=n(43),i=n.n(r);function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,r=[{key:"mixin",value:function(t,n,r){var i,a={};if(t)for(var o in n)n.hasOwnProperty(o)&&(i=n[o],o in t&&(t[o]===i||o in a&&a[o]===i)||("object"===s(t[o])&&null!==t[o]?t[o]=e.mixin(t[o],i,r):t[o]=r(i)));return t}},{key:"clone",value:function(t){if(!t||"object"!==s(t))return t;var n;if(t instanceof Array){n=[];for(var r=0,i=t.length;r<i;++r)r in t&&n.push(e.clone(t[r]))}else n={};return e.mixin(n,t,e.clone)}},{key:"addAditionalQueryParameterToUrl",value:function(e,t){try{if(!t||0===t.length)return e;var n=new URL(e);return t.forEach((function(e){e.key&&e.value&&n.searchParams.set(e.key,e.value)})),n.href}catch(t){return e}}},{key:"parseHttpHeaders",value:function(e){var t={};if(!e)return t;for(var n=e.trim().split("\r\n"),r=0,i=n.length;r<i;r++){var s=n[r],a=s.indexOf(": ");a>0&&(t[s.substring(0,a)]=s.substring(a+2))}return t}},{key:"generateUuid",value:function(){var e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?n:3&n|8).toString(16)}))}},{key:"generateHashCode",value:function(e){var t=0;if(0===e.length)return t;for(var n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return t}},{key:"getRelativeUrl",value:function(e,t){try{var n=new URL(e),r=new URL(t);if(n.protocol=r.protocol,n.origin!==r.origin)return t;var s=i.a.relative(n.pathname.substr(0,n.pathname.lastIndexOf("/")),r.pathname.substr(0,r.pathname.lastIndexOf("/"))),a=0===s.length?1:0;return s+=r.pathname.substr(r.pathname.lastIndexOf("/")+a,r.pathname.length-1),r.pathname.length<s.length?r.pathname:s}catch(e){return t}}}],(n=null)&&a(t.prototype,n),r&&a(t,r),e}();t.a=o},17:function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,i;return t=e,(n=[{key:"extend",value:function(e,t){if(e){var n=!!t&&t.override,r=!!t&&t.publicOnly;for(var i in e)!e.hasOwnProperty(i)||this[i]&&!n||r&&-1===e[i].indexOf("public_")||(this[i]=e[i])}}}])&&r(t.prototype,n),i&&r(t,i),e}();t.a=i},24:function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,i;return t=e,(n=[{key:"extend",value:function(e,t){if(e){var n=!!t&&t.override,r=!!t&&t.publicOnly;for(var i in e)!e.hasOwnProperty(i)||this[i]&&!n||r&&-1===e[i].indexOf("public_")||(this[i]=e[i])}}}])&&r(t.prototype,n),i&&r(t,i),e}();t.a=i},26:function(e,t){var n,r,i=e.exports={};function s(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function o(e){if(n===setTimeout)return setTimeout(e,0);if((n===s||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:s}catch(e){n=s}try{r="function"==typeof clearTimeout?clearTimeout:a}catch(e){r=a}}();var u,c=[],E=!1,l=-1;function f(){E&&u&&(E=!1,u.length?c=u.concat(c):l=-1,c.length&&y())}function y(){if(!E){var e=o(f);E=!0;for(var t=c.length;t;){for(u=c,c=[];++l<t;)u&&u[l].run();l=-1,t=c.length}u=null,E=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===a||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function d(e,t){this.fun=e,this.array=t}function S(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new d(e,t)),1!==c.length||E||o(y)},d.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=S,i.addListener=S,i.once=S,i.off=S,i.removeListener=S,i.removeAllListeners=S,i.emit=S,i.prependListener=S,i.prependOnceListener=S,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},43:function(e,t,n){(function(e){function n(e,t){for(var n=0,r=e.length-1;r>=0;r--){var i=e[r];"."===i?e.splice(r,1):".."===i?(e.splice(r,1),n++):n&&(e.splice(r,1),n--)}if(t)for(;n--;n)e.unshift("..");return e}function r(e,t){if(e.filter)return e.filter(t);for(var n=[],r=0;r<e.length;r++)t(e[r],r,e)&&n.push(e[r]);return n}t.resolve=function(){for(var t="",i=!1,s=arguments.length-1;s>=-1&&!i;s--){var a=s>=0?arguments[s]:e.cwd();if("string"!=typeof a)throw new TypeError("Arguments to path.resolve must be strings");a&&(t=a+"/"+t,i="/"===a.charAt(0))}return(i?"/":"")+(t=n(r(t.split("/"),(function(e){return!!e})),!i).join("/"))||"."},t.normalize=function(e){var s=t.isAbsolute(e),a="/"===i(e,-1);return(e=n(r(e.split("/"),(function(e){return!!e})),!s).join("/"))||s||(e="."),e&&a&&(e+="/"),(s?"/":"")+e},t.isAbsolute=function(e){return"/"===e.charAt(0)},t.join=function(){var e=Array.prototype.slice.call(arguments,0);return t.normalize(r(e,(function(e,t){if("string"!=typeof e)throw new TypeError("Arguments to path.join must be strings");return e})).join("/"))},t.relative=function(e,n){function r(e){for(var t=0;t<e.length&&""===e[t];t++);for(var n=e.length-1;n>=0&&""===e[n];n--);return t>n?[]:e.slice(t,n-t+1)}e=t.resolve(e).substr(1),n=t.resolve(n).substr(1);for(var i=r(e.split("/")),s=r(n.split("/")),a=Math.min(i.length,s.length),o=a,u=0;u<a;u++)if(i[u]!==s[u]){o=u;break}var c=[];for(u=o;u<i.length;u++)c.push("..");return(c=c.concat(s.slice(o))).join("/")},t.sep="/",t.delimiter=":",t.dirname=function(e){if("string"!=typeof e&&(e+=""),0===e.length)return".";for(var t=e.charCodeAt(0),n=47===t,r=-1,i=!0,s=e.length-1;s>=1;--s)if(47===(t=e.charCodeAt(s))){if(!i){r=s;break}}else i=!1;return-1===r?n?"/":".":n&&1===r?"/":e.slice(0,r)},t.basename=function(e,t){var n=function(e){"string"!=typeof e&&(e+="");var t,n=0,r=-1,i=!0;for(t=e.length-1;t>=0;--t)if(47===e.charCodeAt(t)){if(!i){n=t+1;break}}else-1===r&&(i=!1,r=t+1);return-1===r?"":e.slice(n,r)}(e);return t&&n.substr(-1*t.length)===t&&(n=n.substr(0,n.length-t.length)),n},t.extname=function(e){"string"!=typeof e&&(e+="");for(var t=-1,n=0,r=-1,i=!0,s=0,a=e.length-1;a>=0;--a){var o=e.charCodeAt(a);if(47!==o)-1===r&&(i=!1,r=a+1),46===o?-1===t?t=a:1!==s&&(s=1):-1!==t&&(s=-1);else if(!i){n=a+1;break}}return-1===t||-1===r||0===s||1===s&&t===r-1&&t===n+1?"":e.slice(t,r)};var i="b"==="ab".substr(-1)?function(e,t,n){return e.substr(t,n)}:function(e,t,n){return t<0&&(t=e.length+t),e.substr(t,n)}}).call(this,n(26))},5:function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return s}));var i=function e(){r(this,e),this.tcpid=null,this.type=null,this.url=null,this.actualurl=null,this.range=null,this.trequest=null,this.tresponse=null,this.responsecode=null,this.interval=null,this.trace=[],this._stream=null,this._tfinish=null,this._mediaduration=null,this._quality=null,this._responseHeaders=null,this._serviceLocation=null},s=function e(){r(this,e),this.s=null,this.d=null,this.b=[],this.t=null};i.GET="GET",i.HEAD="HEAD",i.MPD_TYPE="MPD",i.XLINK_EXPANSION_TYPE="XLinkExpansion",i.INIT_SEGMENT_TYPE="InitializationSegment",i.INDEX_SEGMENT_TYPE="IndexSegment",i.MEDIA_SEGMENT_TYPE="MediaSegment",i.BITSTREAM_SWITCHING_SEGMENT_TYPE="BitstreamSwitchingSegment",i.MSS_FRAGMENT_INFO_SEGMENT_TYPE="FragmentInfoSegment",i.LICENSE="license",i.OTHER_TYPE="other"},71:function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}n.r(t);var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,i;return t=e,i=[{key:"findCencContentProtection",value:function(e){for(var t=null,n=0;n<e.length;++n){var r=e[n];"urn:mpeg:dash:mp4protection:2011"!==r.schemeIdUri.toLowerCase()||"cenc"!==r.value.toLowerCase()&&"cbcs"!==r.value.toLowerCase()||(t=r)}return t}},{key:"getPSSHData",value:function(e){var t=8,n=new DataView(e),r=n.getUint8(t);return t+=20,r>0&&(t+=4+16*n.getUint32(t)),t+=4,e.slice(t)}},{key:"getPSSHForKeySystem",value:function(t,n){var r=e.parsePSSHList(n);return t&&r.hasOwnProperty(t.uuid.toLowerCase())?r[t.uuid.toLowerCase()]:null}},{key:"parseInitDataFromContentProtection",value:function(e,t){return"pssh"in e?(e.pssh.__text=e.pssh.__text.replace(/\r?\n|\r/g,"").replace(/\s+/g,""),t.decodeArray(e.pssh.__text).buffer):null}},{key:"parsePSSHList",value:function(e){if(null==e)return[];for(var t=new DataView(e.buffer||e),n={},r=0;;){var i,s,a=void 0,o=r;if(r>=t.buffer.byteLength)break;if(i=r+t.getUint32(r),r+=4,1886614376===t.getUint32(r))if(r+=4,0===(s=t.getUint8(r))||1===s){r++,r+=3,a="";var u=void 0,c=void 0;for(u=0;u<4;u++)a+=1===(c=t.getUint8(r+u).toString(16)).length?"0"+c:c;for(r+=4,a+="-",u=0;u<2;u++)a+=1===(c=t.getUint8(r+u).toString(16)).length?"0"+c:c;for(r+=2,a+="-",u=0;u<2;u++)a+=1===(c=t.getUint8(r+u).toString(16)).length?"0"+c:c;for(r+=2,a+="-",u=0;u<2;u++)a+=1===(c=t.getUint8(r+u).toString(16)).length?"0"+c:c;for(r+=2,a+="-",u=0;u<6;u++)a+=1===(c=t.getUint8(r+u).toString(16)).length?"0"+c:c;r+=6,r+=4,n[a=a.toLowerCase()]=t.buffer.slice(o,i),r=i}else r=i;else r=i}return n}}],(n=null)&&r(t.prototype,n),i&&r(t,i),e}();var s=function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.contentType=t,this.robustness=n};var a=function e(t,n,r,i,s){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.initDataTypes=["cenc"],t&&t.length&&(this.audioCapabilities=t),n&&n.length&&(this.videoCapabilities=n),this.distinctiveIdentifier=r,this.persistentState=i,this.sessionTypes=s};function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function c(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=l(e);if(t){var i=l(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return E(this,n)}}function E(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var f=new(function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(n,e);var t=c(n);function n(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),(e=t.call(this)).MEDIA_KEYERR_CODE=100,e.MEDIA_KEYERR_UNKNOWN_CODE=101,e.MEDIA_KEYERR_CLIENT_CODE=102,e.MEDIA_KEYERR_SERVICE_CODE=103,e.MEDIA_KEYERR_OUTPUT_CODE=104,e.MEDIA_KEYERR_HARDWARECHANGE_CODE=105,e.MEDIA_KEYERR_DOMAIN_CODE=106,e.MEDIA_KEY_MESSAGE_ERROR_CODE=107,e.MEDIA_KEY_MESSAGE_NO_CHALLENGE_ERROR_CODE=108,e.SERVER_CERTIFICATE_UPDATED_ERROR_CODE=109,e.KEY_STATUS_CHANGED_EXPIRED_ERROR_CODE=110,e.MEDIA_KEY_MESSAGE_NO_LICENSE_SERVER_URL_ERROR_CODE=111,e.KEY_SYSTEM_ACCESS_DENIED_ERROR_CODE=112,e.KEY_SESSION_CREATED_ERROR_CODE=113,e.MEDIA_KEY_MESSAGE_LICENSER_ERROR_CODE=114,e.MEDIA_KEYERR_UNKNOWN_MESSAGE="An unspecified error occurred. This value is used for errors that don't match any of the other codes.",e.MEDIA_KEYERR_CLIENT_MESSAGE="The Key System could not be installed or updated.",e.MEDIA_KEYERR_SERVICE_MESSAGE="The message passed into update indicated an error from the license service.",e.MEDIA_KEYERR_OUTPUT_MESSAGE="There is no available output device with the required characteristics for the content protection system.",e.MEDIA_KEYERR_HARDWARECHANGE_MESSAGE="A hardware configuration change caused a content protection error.",e.MEDIA_KEYERR_DOMAIN_MESSAGE="An error occurred in a multi-device domain licensing configuration. The most common error is a failure to join the domain.",e.MEDIA_KEY_MESSAGE_ERROR_MESSAGE="Multiple key sessions were creates with a user-agent that does not support sessionIDs!! Unpredictable behavior ahead!",e.MEDIA_KEY_MESSAGE_NO_CHALLENGE_ERROR_MESSAGE="DRM: Empty key message from CDM",e.SERVER_CERTIFICATE_UPDATED_ERROR_MESSAGE="Error updating server certificate -- ",e.KEY_STATUS_CHANGED_EXPIRED_ERROR_MESSAGE="DRM: KeyStatusChange error! -- License has expired",e.MEDIA_KEY_MESSAGE_NO_LICENSE_SERVER_URL_ERROR_MESSAGE="DRM: No license server URL specified!",e.KEY_SYSTEM_ACCESS_DENIED_ERROR_MESSAGE="DRM: KeySystem Access Denied! -- ",e.KEY_SESSION_CREATED_ERROR_MESSAGE="DRM: unable to create session! --",e.MEDIA_KEY_MESSAGE_LICENSER_ERROR_MESSAGE="DRM: licenser error! --",e}return n}(n(24).a)),y=n(8);var d=function e(t,n,r,i,s,a,o,u){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.url=t,this.method=n,this.responseType=r,this.headers=i,this.withCredentials=s,this.messageType=a,this.sessionId=o,this.data=u};var S=function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.url=t,this.headers=n,this.data=r},g=n(5),_=n(14),h=n(1);function p(e){return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function R(e){var t,n,r,o,u,c,E,l,R,m,v=(e=e||{}).protectionKeyController,T=e.protectionModel,D=e.eventBus,A=e.events,C=e.debug,I=e.BASE64,M=e.constants,K=[],O=e.cmcdModel,b=e.settings;function w(){if(!(D&&D.hasOwnProperty("on")&&v&&v.hasOwnProperty("getSupportedKeySystemsFromContentProtection")))throw new Error("Missing config parameter(s)")}function N(e,t){var n=i.getPSSHForKeySystem(l,e),r=P(l);if(n){if(L(n))return;try{T.createKeySession(n,r,G(l),t)}catch(e){D.trigger(A.KEY_SESSION_CREATED,{data:null,error:new y.a(f.KEY_SESSION_CREATED_ERROR_CODE,f.KEY_SESSION_CREATED_ERROR_MESSAGE+e.message)})}}else e?T.createKeySession(e,r,G(l),t):D.trigger(A.KEY_SESSION_CREATED,{data:null,error:new y.a(f.KEY_SESSION_CREATED_ERROR_CODE,f.KEY_SESSION_CREATED_ERROR_MESSAGE+"Selected key system is "+(l?l.systemString:null)+".  needkey/encrypted event contains no initData corresponding to that key system!")})}function L(e){if(!e)return!1;try{for(var t=T.getAllInitData(),r=0;r<t.length;r++)if(v.initDataEquals(e,t[r]))return n.debug("DRM: Ignoring initData because we have already seen it!"),!0;return!1}catch(e){return!1}}function k(e,t){w(),T.loadKeySession(e,t,G(l))}function Y(e){w(),e?(T.setMediaElement(e),D.on(A.NEED_KEY,j,this)):null===e&&(T.setMediaElement(e),D.off(A.NEED_KEY,j,this))}function P(e){var t=null;if(e){var n=e.systemString;u&&(t=n in u?u[n]:null)}return t}function U(e){var t=P(e),n=[],r=[],i=t&&t.audioRobustness&&t.audioRobustness.length>0?t.audioRobustness:E,u=t&&t.videoRobustness&&t.videoRobustness.length>0?t.videoRobustness:E,c=G(e),l=t&&t.distinctiveIdentifier?t.distinctiveIdentifier:"optional",f=t&&t.persistentState?t.persistentState:"temporary"===c?"optional":"required";return o.forEach((function(e){e.type===M.AUDIO?n.push(new s(e.codec,i)):e.type===M.VIDEO&&r.push(new s(e.codec,u))})),new a(n,r,l,f,[c])}function G(e){var t=P(e);return t&&t.sessionType?t.sessionType:c}function F(e,t){e=e.sort((function(t,n){return(u&&u[t.ks.systemString]&&u[t.ks.systemString].priority>=0?u[t.ks.systemString].priority:e.length)-(u&&u[n.ks.systemString]&&u[n.ks.systemString].priority>=0?u[n.ks.systemString].priority:e.length)})),void 0===l?function(e,t){var i,s,a=this,o=[];l=null,r.push(e);for(var u=0;u<e.length;u++)o.push({ks:e[u].ks,configs:[U(e[u].ks)]});var c=function e(r){D.off(A.KEY_SYSTEM_ACCESS_COMPLETE,e,a),r.error?(l=void 0,D.off(A.INTERNAL_KEY_SYSTEM_SELECTED,E,a),t||D.trigger(A.KEY_SYSTEM_SELECTED,{data:null,error:new y.a(f.KEY_SYSTEM_ACCESS_DENIED_ERROR_CODE,f.KEY_SYSTEM_ACCESS_DENIED_ERROR_MESSAGE+r.error)})):(s=r.data,n.info("DRM: KeySystem Access Granted ("+s.keySystem.systemString+")!  Selecting key system..."),T.selectKeySystem(s))},E=function e(n){if(D.off(A.INTERNAL_KEY_SYSTEM_SELECTED,e,a),D.off(A.KEY_SYSTEM_ACCESS_COMPLETE,c,a),n.error)l=void 0,t||D.trigger(A.KEY_SYSTEM_SELECTED,{data:null,error:new y.a(f.KEY_SYSTEM_ACCESS_DENIED_ERROR_CODE,f.KEY_SYSTEM_ACCESS_DENIED_ERROR_MESSAGE+"Error selecting key system! -- "+n.error)});else{if(!T)return;l=T.getKeySystem(),D.trigger(A.KEY_SYSTEM_SELECTED,{data:s});var o=P(l);o&&o.serverCertificate&&o.serverCertificate.length>0&&T.setServerCertificate(I.decodeArray(o.serverCertificate).buffer);for(var u=0;u<r.length;u++)for(i=0;i<r[u].length;i++)if(l===r[u][i].ks){if(v.isClearKey(l)&&o&&o.hasOwnProperty("clearkeys")){var E={kids:Object.keys(o.clearkeys)};r[u][i].initData=(new TextEncoder).encode(JSON.stringify(E))}r[u][i].sessionId?k(r[u][i].sessionId,r[u][i].initData):null!==r[u][i].initData&&N(r[u][i].initData,r[u][i].cdmData);break}}};D.on(A.INTERNAL_KEY_SYSTEM_SELECTED,E,a),D.on(A.KEY_SYSTEM_ACCESS_COMPLETE,c,a),T.requestKeySystemAccess(o)}(e,t):l?function(e,t){var r=this,s=[],a=e.findIndex((function(e){return e.ks===l}));if(-1===a||!e[a].initData)return;if(L(i.getPSSHForKeySystem(l,e[a].initData)))return;s.push({ks:e[a].ks,configs:[U(l)]});D.on(A.KEY_SYSTEM_ACCESS_COMPLETE,(function i(s){if(D.off(A.KEY_SYSTEM_ACCESS_COMPLETE,i,r),s.error)t||D.trigger(A.KEY_SYSTEM_SELECTED,{error:new y.a(f.KEY_SYSTEM_ACCESS_DENIED_ERROR_CODE,f.KEY_SYSTEM_ACCESS_DENIED_ERROR_MESSAGE+s.error)});else{n.info("DRM: KeySystem Access Granted"),D.trigger(A.KEY_SYSTEM_SELECTED,{data:s.data});var o=P(l);if(v.isClearKey(l)&&o&&o.hasOwnProperty("clearkeys")){var u={kids:Object.keys(o.clearkeys)};e[a].initData=(new TextEncoder).encode(JSON.stringify(u))}e[a].sessionId?k(e[a].sessionId,e[a].initData):e[a].initData&&N(e[a].initData,e[a].cdmData)}}),r),T.requestKeySystemAccess(s)}(e,t):r.push(e)}function x(e,t){D.trigger(A.LICENSE_REQUEST_COMPLETE,{data:e,error:t})}function H(e){e.error?D.trigger(A.KEY_STATUSES_CHANGED,{data:null,error:e.error}):n.debug("DRM: key status = "+e.status)}function B(e){n.debug("DRM: onKeyMessage");var t=e.data;D.trigger(A.KEY_MESSAGE,{data:t});var r=t.messageType?t.messageType:"license-request",s=t.message,a=t.sessionToken,u=P(l),c=l?l.systemString:null,E=v.getLicenseServer(l,u,r),C={sessionToken:a,messageType:r};if(s&&0!==s.byteLength){if(!E)return n.debug("DRM: License server request not required for this message (type = "+e.data.messageType+").  Session ID = "+a.getSessionID()),void x(C);if(v.isClearKey(l)){var I=v.processClearKeyLicenseRequest(l,u,s);if(I)return n.debug("DRM: ClearKey license request handled by application!"),x(C),void T.updateKeySession(a,I)}var M=null;if(u&&u.serverURL){var K=u.serverURL;"string"==typeof K&&""!==K?M=K:"object"===p(K)&&K.hasOwnProperty(r)&&(M=K[r])}else if(u&&u.laURL&&""!==u.laURL)M=u.laURL;else if(v.isClearKey(l))M=l.getLicenseServerUrlFromMediaInfo(o);else{var w=i.getPSSHData(a.initData);(M=l.getLicenseServerURLFromInitData(w))||(M=e.data.laURL)}if(M=E.getServerURLFromMessage(M,s,r)){var N={},L=!1,k=function(e){if(e)for(var t in e)"authorization"===t.toLowerCase()&&(L=!0),N[t]=e[t]};u&&k(u.httpRequestHeaders),k(l.getRequestHeadersFromMessage(s)),u&&"boolean"==typeof u.withCredentials&&(L=u.withCredentials);var Y=function(e,t,n,r){var i=e.response?E.getErrorResponse(e.response,n,r):"NONE";x(t,new y.a(f.MEDIA_KEY_MESSAGE_LICENSER_ERROR_CODE,f.MEDIA_KEY_MESSAGE_LICENSER_ERROR_MESSAGE+n+' update, XHR complete. status is "'+e.statusText+'" ('+e.status+"), readyState is "+e.readyState+".  Response is "+i))},U=function(e){if(T)if(e.status>=200&&e.status<=299){var t=new S(e.responseURL,_.a.parseHttpHeaders(e.getAllResponseHeaders?e.getAllResponseHeaders():null),e.response);V(m,t).then((function(){var n=E.getLicenseMessage(t.data,c,r);null!==n?(x(C),T.updateKeySession(a,n)):Y(e,C,c,r)}))}else Y(e,C,c,r)},G=function(e){x(C,new y.a(f.MEDIA_KEY_MESSAGE_LICENSER_ERROR_CODE,f.MEDIA_KEY_MESSAGE_LICENSER_ERROR_MESSAGE+c+' update, XHR aborted. status is "'+e.statusText+'" ('+e.status+"), readyState is "+e.readyState))},F=function(e){x(C,new y.a(f.MEDIA_KEY_MESSAGE_LICENSER_ERROR_CODE,f.MEDIA_KEY_MESSAGE_LICENSER_ERROR_MESSAGE+c+' update, XHR error. status is "'+e.statusText+'" ('+e.status+"), readyState is "+e.readyState))},H=l.getLicenseRequestFromMessage(s),B=E.getHTTPMethod(r),j=E.getResponseType(c,r),q=u&&!isNaN(u.httpTimeout)?u.httpTimeout:8e3,W=a.getSessionID()||null,X=new d(M,B,j,N,L,r,W,H),J=isNaN(b.get().streaming.retryAttempts[g.a.LICENSE])?3:b.get().streaming.retryAttempts[g.a.LICENSE];V(R,X).then((function(){!function e(t,r,i,s,a,o){var u=new XMLHttpRequest;if(b.get().streaming.cmcd&&b.get().streaming.cmcd.enabled){if(b.get().streaming.cmcd.mode===h.a.CMCD_MODE_QUERY){var c=O.getQueryParameter({url:t.url,type:g.a.LICENSE});c&&(t.url=_.a.addAditionalQueryParameterToUrl(t.url,[c]))}}u.open(t.method,t.url,!0),u.responseType=t.responseType,u.withCredentials=t.withCredentials,i>0&&(u.timeout=i);for(var E in t.headers)u.setRequestHeader(E,t.headers[E]);if(b.get().streaming.cmcd&&b.get().streaming.cmcd.enabled){if(b.get().streaming.cmcd.mode===h.a.CMCD_MODE_HEADER){var l=O.getHeaderParameters({url:t.url,type:g.a.LICENSE});if(l)for(var f in l){var y=l[f];y&&u.setRequestHeader(f,y)}}}var d=function(){r--;var n=isNaN(b.get().streaming.retryIntervals[g.a.LICENSE])?1e3:b.get().streaming.retryIntervals[g.a.LICENSE];setTimeout((function(){e(t,r,i,s,a,o)}),n)};u.onload=function(){this.status>=200&&this.status<=299||r<=0?s(this):(n.warn("License request failed ("+this.status+"). Retrying it... Pending retries: "+r),d())},u.ontimeout=u.onerror=function(){r<=0?o(this):(n.warn("License request network request failed . Retrying it... Pending retries: "+r),d())},u.onabort=function(){a(this)},D.trigger(A.LICENSE_REQUEST_SENDING,{url:t.url,headers:t.headers,payload:t.data,sessionId:t.sessionId}),u.send(t.data)}(X,J,q,U,G,F)}))}else x(C,new y.a(f.MEDIA_KEY_MESSAGE_NO_LICENSE_SERVER_URL_ERROR_CODE,f.MEDIA_KEY_MESSAGE_NO_LICENSE_SERVER_URL_ERROR_MESSAGE))}else x(C,new y.a(f.MEDIA_KEY_MESSAGE_NO_CHALLENGE_ERROR_CODE,f.MEDIA_KEY_MESSAGE_NO_CHALLENGE_ERROR_MESSAGE))}function j(e,t){if(n.debug("DRM: onNeedKey"),"cenc"===e.key.initDataType)if(0===o.length&&(n.warn("DRM: onNeedKey called before initializeForMedia, wait until initialized"),(t=void 0===t?1:t+1)<5))K.push(setTimeout((function(){j(e,t)}),500));else{var r=e.key.initData;if(ArrayBuffer.isView(r)&&(r=r.buffer),l){var s=i.getPSSHForKeySystem(l,r);if(s&&L(s))return}n.debug("DRM: initData:",String.fromCharCode.apply(null,new Uint8Array(r)));var a=v.getSupportedKeySystems(r,u);0!==a.length?F(a,!1):n.debug("DRM: Received needkey event with initData, but we don't support any of the key systems!")}else n.warn("DRM:  Only 'cenc' initData is supported!  Ignoring initData of type: "+e.key.initDataType)}function V(e,t){return e?e.reduce((function(e,n){return e.then((function(){return n(t)}))}),Promise.resolve()):Promise.resolve()}return t={initializeForMedia:function(e){if(!e)throw new Error("mediaInfo can not be null or undefined");w(),D.on(A.INTERNAL_KEY_MESSAGE,B,this),D.on(A.INTERNAL_KEY_STATUS_CHANGED,H,this),o.push(e);var t=v.getSupportedKeySystemsFromContentProtection(e.contentProtection);t&&t.length>0&&F(t,!0)},clearMediaInfoArrayByStreamId:function(e){o=o.filter((function(t){return t.streamInfo.id!==e}))},createKeySession:N,loadKeySession:k,removeKeySession:function(e){w(),T.removeKeySession(e)},closeKeySession:function(e){w(),T.closeKeySession(e)},setServerCertificate:function(e){w(),T.setServerCertificate(e)},setMediaElement:Y,setSessionType:function(e){c=e},setRobustnessLevel:function(e){E=e},setProtectionData:function(e){u=e,v.setProtectionData(e)},getSupportedKeySystemsFromContentProtection:function(e){return w(),v.getSupportedKeySystemsFromContentProtection(e)},getKeySystems:function(){return v?v.getKeySystems():[]},setKeySystems:function(e){v&&v.setKeySystems(e)},setLicenseRequestFilters:function(e){R=e},setLicenseResponseFilters:function(e){m=e},stop:function(){T&&T.stop()},reset:function(){w(),R=[],m=[],D.off(A.INTERNAL_KEY_MESSAGE,B,this),D.off(A.INTERNAL_KEY_STATUS_CHANGED,H,this),Y(null),l=void 0,T&&(T.reset(),T=null),K.forEach((function(e){return clearTimeout(e)})),K=[],o=[]}},n=C.getLogger(t),r=[],o=[],c="temporary",E="",R=[],m=[],t}R.__dashjs_factory_name="ProtectionController";var m=dashjs.FactoryMaker.getClassFactory(R);var v=function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.keyID=t,this.key=n};function T(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var D=function(){function e(t,n){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),n&&"persistent"!==n&&"temporary"!==n)throw new Error("Invalid ClearKey key set type!  Must be one of 'persistent' or 'temporary'");this.keyPairs=t,this.type=n}var t,n,r;return t=e,(n=[{key:"toJWK",value:function(){var e,t=this.keyPairs.length,n={keys:[]};for(e=0;e<t;e++){var r={kty:"oct",alg:"A128KW",kid:this.keyPairs[e].keyID,k:this.keyPairs[e].key};n.keys.push(r)}this.type&&(n.type=this.type);var i=JSON.stringify(n),s=i.length,a=new ArrayBuffer(s),o=new Uint8Array(a);for(e=0;e<s;e++)o[e]=i.charCodeAt(e);return a}}])&&T(t.prototype,n),r&&T(t,r),e}();function A(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var C=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.init()}var t,n,r;return t=e,(n=[{key:"init",value:function(){this.CLEARKEY_KEYSTEM_STRING="org.w3.clearkey",this.WIDEVINE_KEYSTEM_STRING="com.widevine.alpha",this.PLAYREADY_KEYSTEM_STRING="com.microsoft.playready"}}])&&A(t.prototype,n),r&&A(t,r),e}()),I="e2719d58-a985-b3c9-781a-b030af78d30e",M=C.CLEARKEY_KEYSTEM_STRING,K="urn:uuid:"+I;function O(e){var t=(e=e||{}).BASE64,n={attributes:["Laurl","laurl"],prefixes:["clearkey","dashif"]};return{uuid:I,schemeIdURI:K,systemString:M,getInitData:function(e,n){try{var r=i.parseInitDataFromContentProtection(e,t);if(!r&&n){var s={kids:[function(e){try{var t=e.replace(/-/g,"");return(t=btoa(t.match(/\w{2}/g).map((function(e){return String.fromCharCode(parseInt(e,16))})).join(""))).replace(/=/g,"")}catch(e){return null}}(n["cenc:default_KID"])]};r=(new TextEncoder).encode(JSON.stringify(s))}return r}catch(e){return null}},getRequestHeadersFromMessage:function(){return{"Content-Type":"application/json"}},getLicenseRequestFromMessage:function(e){return JSON.parse(String.fromCharCode.apply(null,new Uint8Array(e)))},getLicenseServerURLFromInitData:function(){return null},getCDMData:function(){return null},getSessionId:function(){return null},getLicenseServerUrlFromMediaInfo:function(e){try{if(!e||0===e.length)return null;for(var t=0,r=null;t<e.length&&!r;){var i=e[t];if(i&&i.contentProtection&&i.contentProtection.length>0){var s=i.contentProtection.filter((function(e){return e.schemeIdUri&&e.schemeIdUri===K}));if(s&&s.length>0)for(var a=0;a<s.length&&!r;){for(var o=s[a],u=0;u<n.attributes.length&&!r;){for(var c=0,E=n.attributes[u];c<n.prefixes.length&&!r;){var l=n.prefixes[c];o[E]&&o[E].__prefix&&o[E].__prefix===l&&o[E].__text&&(r=o[E].__text),c+=1}u+=1}a+=1}}t+=1}return r}catch(e){return null}},getClearKeysFromProtectionData:function(e,t){var n=null;if(e){for(var r=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(t))),i=[],s=0;s<r.kids.length;s++){var a=r.kids[s],o=e.clearkeys&&e.clearkeys.hasOwnProperty(a)?e.clearkeys[a]:null;if(!o)throw new Error("DRM: ClearKey keyID ("+a+") is not known!");i.push(new v(a,o))}n=new D(i)}return n}}}O.__dashjs_factory_name="KeySystemClearKey";var b=dashjs.FactoryMaker.getSingletonFactory(O),w=C.CLEARKEY_KEYSTEM_STRING;function N(e){var t,n=e.BASE64,r=e.debug.getLogger(t);return t={uuid:"1077efec-c0b2-4d02-ace3-3c1e52e2fb4b",schemeIdURI:"urn:uuid:1077efec-c0b2-4d02-ace3-3c1e52e2fb4b",systemString:w,getInitData:function(e){return i.parseInitDataFromContentProtection(e,n)},getRequestHeadersFromMessage:function(){return null},getLicenseRequestFromMessage:function(e){return new Uint8Array(e)},getLicenseServerURLFromInitData:function(){return null},getCDMData:function(){return null},getSessionId:function(){return null},getClearKeysFromProtectionData:function(e,t){var n=null;if(e){for(var i=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(t))),s=[],a=0;a<i.kids.length;a++){var o=i.kids[a],u=e.clearkeys&&e.clearkeys.hasOwnProperty(o)?e.clearkeys[o]:null;if(!u)throw new Error("DRM: ClearKey keyID ("+o+") is not known!");s.push(new v(o,u))}n=new D(s),r.warn("ClearKey schemeIdURI is using W3C Common PSSH systemID (1077efec-c0b2-4d02-ace3-3c1e52e2fb4b) in Content Protection. See DASH-IF IOP v4.1 section 7.6.2.4")}return n}}}N.__dashjs_factory_name="KeySystemW3CClearKey";var L=dashjs.FactoryMaker.getSingletonFactory(N),k=C.WIDEVINE_KEYSTEM_STRING;function Y(e){var t=null,n=(e=e||{}).BASE64;return{uuid:"edef8ba9-79d6-4ace-a3c8-27dcd51d21ed",schemeIdURI:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed",systemString:k,init:function(e){e&&(t=e)},getInitData:function(e){return i.parseInitDataFromContentProtection(e,n)},getRequestHeadersFromMessage:function(){return null},getLicenseRequestFromMessage:function(e){return new Uint8Array(e)},getLicenseServerURLFromInitData:function(){return null},getCDMData:function(){return null},getSessionId:function(e){return t&&t.sessionId?t.sessionId:e&&e.sessionId?e.sessionId:null}}}Y.__dashjs_factory_name="KeySystemWidevine";var P,U=dashjs.FactoryMaker.getSingletonFactory(Y),G=C.PLAYREADY_KEYSTEM_STRING;function F(e){var t="utf-16",n=(e=e||{}).BASE64;function r(){if(!n||!n.hasOwnProperty("decodeArray")||!n.hasOwnProperty("decodeArray"))throw new Error("Missing config parameter(s)")}return{uuid:"9a04f079-9840-4286-ab92-e65be0885f95",schemeIdURI:"urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95",systemString:G,getInitData:function(e){var t,s,a,o,u,c=new Uint8Array([112,115,115,104,0,0,0,0]),E=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]),l=0,f=null;if(r(),!e)return null;if("pssh"in e)return i.parseInitDataFromContentProtection(e,n);if("pro"in e)f=n.decodeArray(e.pro.__text);else{if(!("prheader"in e))return null;f=n.decodeArray(e.prheader.__text)}return t=f.length,s=4+c.length+E.length+4+t,a=new ArrayBuffer(s),o=new Uint8Array(a),(u=new DataView(a)).setUint32(l,s),l+=4,o.set(c,l),l+=c.length,o.set(E,l),l+=E.length,u.setUint32(l,t),l+=4,o.set(f,l),l+=t,o.buffer},getRequestHeadersFromMessage:function(e){var n,r,i={},s=new DOMParser,a="utf-16"===t?new Uint16Array(e):new Uint8Array(e);n=String.fromCharCode.apply(null,a);for(var o=(r=s.parseFromString(n,"application/xml")).getElementsByTagName("name"),u=r.getElementsByTagName("value"),c=0;c<o.length;c++)i[o[c].childNodes[0].nodeValue]=u[c].childNodes[0].nodeValue;return i.hasOwnProperty("Content")&&(i["Content-Type"]=i.Content,delete i.Content),i.hasOwnProperty("Content-Type")||(i["Content-Type"]="text/xml; charset=utf-8"),i},getLicenseRequestFromMessage:function(e){var i=null,s=new DOMParser,a="utf-16"===t?new Uint16Array(e):new Uint8Array(e);r();var o=String.fromCharCode.apply(null,a),u=s.parseFromString(o,"application/xml");if(!u.getElementsByTagName("PlayReadyKeyMessage")[0])return e;var c=u.getElementsByTagName("Challenge")[0].childNodes[0].nodeValue;return c&&(i=n.decode(c)),i},getLicenseServerURLFromInitData:function(e){if(e)for(var t=new DataView(e),n=t.getUint16(4,!0),r=6,i=new DOMParser,s=0;s<n;s++){var a=t.getUint16(r,!0);r+=2;var o=t.getUint16(r,!0);if(r+=2,1===a){var u=e.slice(r,r+o),c=String.fromCharCode.apply(null,new Uint16Array(u)),E=i.parseFromString(c,"application/xml");if(E.getElementsByTagName("LA_URL")[0]){var l=E.getElementsByTagName("LA_URL")[0].childNodes[0].nodeValue;if(l)return l}if(E.getElementsByTagName("LUI_URL")[0]){var f=E.getElementsByTagName("LUI_URL")[0].childNodes[0].nodeValue;if(f)return f}}else r+=o}return null},getCDMData:function(){var e,t,i,s;if(r(),P&&P.cdmData){for(e=[],s=0;s<P.cdmData.length;++s)e.push(P.cdmData.charCodeAt(s)),e.push(0);for(e=String.fromCharCode.apply(null,e),e=n.encode(e),t='<PlayReadyCDMData type="LicenseAcquisition"><LicenseAcquisition version="1.0" Proactive="false"><CustomData encoding="base64encoded">%CUSTOMDATA%</CustomData></LicenseAcquisition></PlayReadyCDMData>'.replace("%CUSTOMDATA%",e),i=[],s=0;s<t.length;++s)i.push(t.charCodeAt(s)),i.push(0);return new Uint8Array(i).buffer}return null},getSessionId:function(e){return P&&P.sessionId?P.sessionId:e&&e.sessionId?e.sessionId:null},setPlayReadyMessageFormat:function(e){if("utf-8"!==e&&"utf-16"!==e)throw new Error('Specified message format is not one of "utf-8" or "utf-16"');t=e},init:function(e){e&&(P=e)}}}F.__dashjs_factory_name="KeySystemPlayReady";var x=dashjs.FactoryMaker.getSingletonFactory(F);function H(e){var t=(e=e||{}).BASE64,n={};return n[C.WIDEVINE_KEYSTEM_STRING]={responseType:"json",getLicenseMessage:function(e){return t.decodeArray(e.license)},getErrorResponse:function(e){return e}},n[C.PLAYREADY_KEYSTEM_STRING]={responseType:"arraybuffer",getLicenseMessage:function(e){return e},getErrorResponse:function(e){return String.fromCharCode.apply(null,new Uint8Array(e))}},{getServerURLFromMessage:function(e){return e},getHTTPMethod:function(){return"POST"},getResponseType:function(e){return n[e].responseType},getLicenseMessage:function(e,r){return function(){if(!t||!t.hasOwnProperty("decodeArray"))throw new Error("Missing config parameter(s)")}(),n[r].getLicenseMessage(e)},getErrorResponse:function(e,t){return n[t].getErrorResponse(e)}}}H.__dashjs_factory_name="DRMToday";var B=dashjs.FactoryMaker.getSingletonFactory(H);function j(){var e="http://schemas.xmlsoap.org/soap/envelope/";function t(e){var t=String.fromCharCode.apply(null,new Uint8Array(e));return decodeURIComponent(escape(t))}function n(n){if(window.DOMParser){var r=t(n),i=(new window.DOMParser).parseFromString(r,"text/xml"),s=i?i.getElementsByTagNameNS(e,"Envelope")[0]:null,a=s?s.getElementsByTagNameNS(e,"Body")[0]:null;if(a?a.getElementsByTagNameNS(e,"Fault")[0]:null)return null}return n}function r(n){var r="",i="",s="",a=-1,o=-1;if(window.DOMParser){var u=t(n),c=(new window.DOMParser).parseFromString(u,"text/xml"),E=c?c.getElementsByTagNameNS(e,"Envelope")[0]:null,l=E?E.getElementsByTagNameNS(e,"Body")[0]:null,f=l?l.getElementsByTagNameNS(e,"Fault")[0]:null,y=f?f.getElementsByTagName("detail")[0]:null,d=y?y.getElementsByTagName("Exception")[0]:null,S=null;if(null===f)return u;r=(S=f.getElementsByTagName("faultstring")[0].firstChild)?S.nodeValue:null,null!==d&&(i=(S=d.getElementsByTagName("StatusCode")[0])?S.firstChild.nodeValue:null,a=(s=(S=d.getElementsByTagName("Message")[0])?S.firstChild.nodeValue:null)?s.lastIndexOf("[")+1:-1,o=s?s.indexOf("]"):-1,s=s?s.substring(a,o):"")}var g="code: ".concat(i,", name: ").concat(r);return s&&(g+=", message: ".concat(s)),g}return{getServerURLFromMessage:function(e){return e},getHTTPMethod:function(){return"POST"},getResponseType:function(){return"arraybuffer"},getLicenseMessage:function(e){return n.call(this,e)},getErrorResponse:function(e){return r.call(this,e)}}}j.__dashjs_factory_name="PlayReady";var V=dashjs.FactoryMaker.getSingletonFactory(j);function q(){return{getServerURLFromMessage:function(e){return e},getHTTPMethod:function(){return"POST"},getResponseType:function(){return"arraybuffer"},getLicenseMessage:function(e){return e},getErrorResponse:function(e){return String.fromCharCode.apply(null,new Uint8Array(e))}}}q.__dashjs_factory_name="Widevine";var W=dashjs.FactoryMaker.getSingletonFactory(q);function X(){return{getServerURLFromMessage:function(e){return e},getHTTPMethod:function(){return"POST"},getResponseType:function(){return"json"},getLicenseMessage:function(e){if(!e.hasOwnProperty("keys"))return null;for(var t=[],n=0;n<e.keys.length;n++){var r=e.keys[n],i=r.kid.replace(/=/g,""),s=r.k.replace(/=/g,"");t.push(new v(i,s))}return new D(t)},getErrorResponse:function(e){return String.fromCharCode.apply(null,new Uint8Array(e))}}}X.__dashjs_factory_name="ClearKey";var J=dashjs.FactoryMaker.getSingletonFactory(X);function z(){var e,t,n,r,s,a,o,u=this.context;return e={initialize:function(){var e;r=[],e=x(u).getInstance({BASE64:s}),r.push(e),e=U(u).getInstance({BASE64:s}),r.push(e),e=b(u).getInstance({BASE64:s}),r.push(e),a=e,e=L(u).getInstance({BASE64:s,debug:t}),r.push(e),o=e},setProtectionData:function(e){for(var t,n,i=0;i<r.length;i++){var s=r[i];s.hasOwnProperty("init")&&s.init((t=s.systemString,n=void 0,n=null,e&&(n=t in e?e[t]:null),n))}},isClearKey:function(e){return e===a||e===o},initDataEquals:function(e,t){if(e.byteLength===t.byteLength){for(var n=new Uint8Array(e),r=new Uint8Array(t),i=0;i<n.length;i++)if(n[i]!==r[i])return!1;return!0}return!1},getKeySystems:function(){return r},setKeySystems:function(e){r=e},getKeySystemBySystemString:function(e){for(var t=0;t<r.length;t++)if(r[t].systemString===e)return r[t];return null},getSupportedKeySystemsFromContentProtection:function(e){var t,n,s,a,o=[];if(e){var u=i.findCencContentProtection(e);for(s=0;s<r.length;++s)for(n=r[s],a=0;a<e.length;++a)if((t=e[a]).schemeIdUri.toLowerCase()===n.schemeIdURI){var c=n.getInitData(t,u);o.push({ks:r[s],initData:c,cdmData:n.getCDMData(),sessionId:n.getSessionId(t)})}}return o},getSupportedKeySystems:function(e,t){for(var n,s,a,o=[],u=i.parsePSSHList(e),c=0;c<r.length;++c)s=(n=r[c]).systemString,a=!t||s in t,n.uuid in u&&a&&o.push({ks:n,initData:u[n.uuid],cdmData:n.getCDMData(),sessionId:n.getSessionId()});return o},getLicenseServer:function(e,t,n){if("license-release"===n||"individualization-request"===n)return null;var r=null;return t&&t.hasOwnProperty("drmtoday")?r=B(u).getInstance({BASE64:s}):e.systemString===C.WIDEVINE_KEYSTEM_STRING?r=W(u).getInstance():e.systemString===C.PLAYREADY_KEYSTEM_STRING?r=V(u).getInstance():e.systemString===C.CLEARKEY_KEYSTEM_STRING&&(r=J(u).getInstance()),r},processClearKeyLicenseRequest:function(e,t,r){try{return e.getClearKeysFromProtectionData(t,r)}catch(e){return n.error("Failed to retrieve clearkeys from ProtectionData"),null}},setConfig:function(r){r&&(r.debug&&(t=r.debug,n=t.getLogger(e)),r.BASE64&&(s=r.BASE64))}}}z.__dashjs_factory_name="ProtectionKeyController";var Q=dashjs.FactoryMaker.getSingletonFactory(z);function Z(e){return(Z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function $(e,t){return($=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ee(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ne(e);if(t){var i=ne(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return te(this,n)}}function te(e,t){return!t||"object"!==Z(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ne(e){return(ne=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var re=new(function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&$(e,t)}(n,e);var t=ee(n);function n(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),(e=t.call(this)).INTERNAL_KEY_MESSAGE="internalKeyMessage",e.INTERNAL_KEY_SYSTEM_SELECTED="internalKeySystemSelected",e.INTERNAL_KEY_STATUS_CHANGED="internalkeyStatusChanged",e.KEY_ADDED="public_keyAdded",e.KEY_ERROR="public_keyError",e.KEY_MESSAGE="public_keyMessage",e.KEY_SESSION_CLOSED="public_keySessionClosed",e.KEY_SESSION_CREATED="public_keySessionCreated",e.KEY_SESSION_REMOVED="public_keySessionRemoved",e.KEY_STATUSES_CHANGED="public_keyStatusesChanged",e.KEY_SYSTEM_ACCESS_COMPLETE="public_keySystemAccessComplete",e.KEY_SYSTEM_SELECTED="public_keySystemSelected",e.LICENSE_REQUEST_COMPLETE="public_licenseRequestComplete",e.LICENSE_REQUEST_SENDING="public_licenseRequestSending",e.NEED_KEY="needkey",e.PROTECTION_CREATED="public_protectioncreated",e.PROTECTION_DESTROYED="public_protectiondestroyed",e.SERVER_CERTIFICATE_UPDATED="serverCertificateUpdated",e.TEARDOWN_COMPLETE="protectionTeardownComplete",e.VIDEO_ELEMENT_SELECTED="videoElementSelected",e.KEY_SESSION_UPDATED="public_keySessionUpdated",e}return n}(n(17).a));var ie=function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.initData=t,this.initDataType=n};var se=function e(t,n,r,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.sessionToken=t,this.message=n,this.defaultURL=r,this.messageType=i||"license-request"};var ae=function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.keySystem=t,this.ksConfiguration=n};function oe(e){e=e||{};var t,n,r,i,s,a,o,u,c=this.context,E=e.eventBus,l=e.events,d=e.debug;function S(e){var t=e.session;return t.removeEventListener("keystatuseschange",e),t.removeEventListener("message",e),t.close()}function g(e){for(var t=0;t<a.length;t++)if(a[t]===e){a.splice(t,1);break}}function _(e){var t,n;return e&&e.length>0&&(e[0]&&("string"==typeof e[0]?t=e[0]:n=e[0]),e[1]&&("string"==typeof e[1]?t=e[1]:n=e[1])),{status:t,keyId:n}}function h(e,t,r,i){var s={session:e,initData:t,sessionId:i,handleEvent:function(e){switch(e.type){case"keystatuseschange":E.trigger(l.KEY_STATUSES_CHANGED,{data:this}),e.target.keyStatuses.forEach((function(){var e=_(arguments);switch(e.status){case"expired":E.trigger(l.INTERNAL_KEY_STATUS_CHANGED,{error:new y.a(f.KEY_STATUS_CHANGED_EXPIRED_ERROR_CODE,f.KEY_STATUS_CHANGED_EXPIRED_ERROR_MESSAGE)});break;default:E.trigger(l.INTERNAL_KEY_STATUS_CHANGED,e)}}));break;case"message":var t=ArrayBuffer.isView(e.message)?e.message.buffer:e.message;E.trigger(l.INTERNAL_KEY_MESSAGE,{data:new se(this,t,void 0,e.messageType)})}},getSessionID:function(){return e.sessionId},getExpirationTime:function(){return e.expiration},getKeyStatuses:function(){return e.keyStatuses},getUsable:function(){var t=!1;return e.keyStatuses.forEach((function(){var e=_(arguments);"usable"===e.status&&(t=!0)})),t},getSessionType:function(){return r}};return e.addEventListener("keystatuseschange",s),e.addEventListener("message",s),e.closed.then((function(){g(s),n.debug("DRM: Session closed.  SessionID = "+s.getSessionID()),E.trigger(l.KEY_SESSION_CLOSED,{data:s.getSessionID()})})),a.push(s),s}return t={getAllInitData:function(){for(var e=[],t=0;t<a.length;t++)a[t].initData&&e.push(a[t].initData);return e},requestKeySystemAccess:function(e){!function e(t,n){if(void 0===navigator.requestMediaKeySystemAccess||"function"!=typeof navigator.requestMediaKeySystemAccess)return void E.trigger(l.KEY_SYSTEM_ACCESS_COMPLETE,{error:"Insecure origins are not allowed"});!function(n){var r=t[n].ks,i=t[n].configs,s=r.systemString;s===C.PLAYREADY_KEYSTEM_STRING&&"required"===i[0].persistentState&&(s+=".recommendation"),navigator.requestMediaKeySystemAccess(s,i).then((function(e){var t="function"==typeof e.getConfiguration?e.getConfiguration():null,n=new ae(r,t);n.mksa=e,E.trigger(l.KEY_SYSTEM_ACCESS_COMPLETE,{data:n})})).catch((function(r){++n<t.length?e(t,n):E.trigger(l.KEY_SYSTEM_ACCESS_COMPLETE,{error:"Key system access denied! "+r.message})}))}(n)}(e,0)},getKeySystem:function(){return r},selectKeySystem:function(e){e.mksa.createMediaKeys().then((function(t){r=e.keySystem,s=t,i?i.setMediaKeys(s).then((function(){E.trigger(l.INTERNAL_KEY_SYSTEM_SELECTED)})):E.trigger(l.INTERNAL_KEY_SYSTEM_SELECTED)})).catch((function(){E.trigger(l.INTERNAL_KEY_SYSTEM_SELECTED,{error:"Error selecting keys system ("+e.keySystem.systemString+")! Could not create MediaKeys -- TODO"})}))},setMediaElement:function(e){i!==e&&(i&&(i.removeEventListener("encrypted",o),i.setMediaKeys&&i.setMediaKeys(null)),(i=e)&&(i.addEventListener("encrypted",o),i.setMediaKeys&&s&&i.setMediaKeys(s)))},setServerCertificate:function(e){if(!r||!s)throw new Error("Can not set server certificate until you have selected a key system");s.setServerCertificate(e).then((function(){n.info("DRM: License server certificate successfully updated."),E.trigger(l.SERVER_CERTIFICATE_UPDATED)})).catch((function(e){E.trigger(l.SERVER_CERTIFICATE_UPDATED,{error:new y.a(f.SERVER_CERTIFICATE_UPDATED_ERROR_CODE,f.SERVER_CERTIFICATE_UPDATED_ERROR_MESSAGE+e.name)})}))},createKeySession:function(e,t,i){if(!r||!s)throw new Error("Can not create sessions until you have selected a key system");var a=s.createSession(i),o=h(a,e,i),u=this.getKeySystem().systemString===C.CLEARKEY_KEYSTEM_STRING&&(e||t&&t.clearkeys)?"keyids":"cenc";a.generateRequest(u,e).then((function(){n.debug("DRM: Session created.  SessionID = "+o.getSessionID()),E.trigger(l.KEY_SESSION_CREATED,{data:o})})).catch((function(e){g(o),E.trigger(l.KEY_SESSION_CREATED,{data:null,error:new y.a(f.KEY_SESSION_CREATED_ERROR_CODE,f.KEY_SESSION_CREATED_ERROR_MESSAGE+"Error generating key request -- "+e.name)})}))},updateKeySession:function(e,t){var n=e.session;u.isClearKey(r)&&(t=t.toJWK()),n.update(t).then((function(){E.trigger(l.KEY_SESSION_UPDATED)})).catch((function(t){E.trigger(l.KEY_ERROR,{error:new y.a(f.MEDIA_KEYERR_CODE,"Error sending update() message! "+t.name,e)})}))},loadKeySession:function(e,t,i){if(!r||!s)throw new Error("Can not load sessions until you have selected a key system");for(var o=0;o<a.length;o++)if(e===a[o].sessionId)return void n.warn("DRM: Ignoring session ID because we have already seen it!");var u=s.createSession(i),c=h(u,t,i,e);u.load(e).then((function(t){t?(n.debug("DRM: Session loaded.  SessionID = "+c.getSessionID()),E.trigger(l.KEY_SESSION_CREATED,{data:c})):(g(c),E.trigger(l.KEY_SESSION_CREATED,{data:null,error:new y.a(f.KEY_SESSION_CREATED_ERROR_CODE,f.KEY_SESSION_CREATED_ERROR_MESSAGE+"Could not load session! Invalid Session ID ("+e+")")}))})).catch((function(t){g(c),E.trigger(l.KEY_SESSION_CREATED,{data:null,error:new y.a(f.KEY_SESSION_CREATED_ERROR_CODE,f.KEY_SESSION_CREATED_ERROR_MESSAGE+"Could not load session ("+e+")! "+t.name)})}))},removeKeySession:function(e){e.session.remove().then((function(){n.debug("DRM: Session removed.  SessionID = "+e.getSessionID()),E.trigger(l.KEY_SESSION_REMOVED,{data:e.getSessionID()})}),(function(t){E.trigger(l.KEY_SESSION_REMOVED,{data:null,error:"Error removing session ("+e.getSessionID()+"). "+t.name})}))},closeKeySession:function(e){S(e).catch((function(t){g(e),E.trigger(l.KEY_SESSION_CLOSED,{data:null,error:"Error closing session ("+e.getSessionID()+") "+t.name})}))},stop:function(){for(var e,t=0;t<a.length;t++)(e=a[t]).getUsable()||S(e).catch((function(){g(e)}))},reset:function(){var e,t=a.length;0!==t?function(){for(var n=function(e){g(e),0===a.length&&(i?(i.removeEventListener("encrypted",o),i.setMediaKeys(null).then((function(){E.trigger(l.TEARDOWN_COMPLETE)}))):E.trigger(l.TEARDOWN_COMPLETE))},r=0;r<t;r++)!function(t){e.session.closed.then((function(){n(t)})),S(e).catch((function(){n(t)}))}(e=a[r])}():E.trigger(l.TEARDOWN_COMPLETE)}},n=d.getLogger(t),r=null,i=null,s=null,a=[],u=Q(c).getInstance(),o={handleEvent:function(e){switch(e.type){case"encrypted":if(e.initData){var t=ArrayBuffer.isView(e.initData)?e.initData.buffer:e.initData;E.trigger(l.NEED_KEY,{key:new ie(t,e.initDataType)})}}}},t}oe.__dashjs_factory_name="ProtectionModel_21Jan2015";var ue=dashjs.FactoryMaker.getClassFactory(oe);function ce(e){e=e||{};var t,n,r,i,s,o,u,c,E,l=this.context,d=e.eventBus,S=e.events,g=e.debug,_=e.api;function h(){try{for(var e=0;e<u.length;e++)p(u[e]);r&&r.removeEventListener(_.needkey,c),d.trigger(S.TEARDOWN_COMPLETE)}catch(e){d.trigger(S.TEARDOWN_COMPLETE,{error:"Error tearing down key sessions and MediaKeys! -- "+e.message})}}function p(e){var t=e.session;t.removeEventListener(_.error,e),t.removeEventListener(_.message,e),t.removeEventListener(_.ready,e),t.removeEventListener(_.close,e);for(var n=0;n<u.length;n++)if(u[n]===e){u.splice(n,1);break}t[_.release]()}function R(){var e=null,t=function(){r.removeEventListener("loadedmetadata",e),r[_.setMediaKeys](s),d.trigger(S.VIDEO_ELEMENT_SELECTED)};r.readyState>=1?t():(e=t.bind(this),r.addEventListener("loadedmetadata",e))}return t={getAllInitData:function(){for(var e=[],t=0;t<u.length;t++)e.push(u[t].initData);return e},requestKeySystemAccess:function(e){for(var t=!1,n=0;n<e.length;n++)for(var r=e[n].ks.systemString,i=e[n].configs,s=null,o=null,u=0;u<i.length;u++){var c=i[u].audioCapabilities,l=i[u].videoCapabilities;if(c&&0!==c.length){s=[];for(var f=0;f<c.length;f++)window[_.MediaKeys].isTypeSupported(r,c[f].contentType)&&s.push(c[f])}if(l&&0!==l.length){o=[];for(var y=0;y<l.length;y++)window[_.MediaKeys].isTypeSupported(r,l[y].contentType)&&o.push(l[y])}if(!(!s&&!o||s&&0===s.length||o&&0===o.length)){t=!0;var g=new a(s,o),h=E.getKeySystemBySystemString(r);d.trigger(S.KEY_SYSTEM_ACCESS_COMPLETE,{data:new ae(h,g)});break}}t||d.trigger(S.KEY_SYSTEM_ACCESS_COMPLETE,{error:"Key system access denied! -- No valid audio/video content configurations detected!"})},getKeySystem:function(){return i},selectKeySystem:function(e){try{s=e.mediaKeys=new window[_.MediaKeys](e.keySystem.systemString),i=e.keySystem,o=e,r&&R(),d.trigger(S.INTERNAL_KEY_SYSTEM_SELECTED)}catch(e){d.trigger(S.INTERNAL_KEY_SYSTEM_SELECTED,{error:"Error selecting keys system ("+i.systemString+")! Could not create MediaKeys -- TODO"})}},setMediaElement:function(e){r!==e&&(r&&r.removeEventListener(_.needkey,c),(r=e)&&(r.addEventListener(_.needkey,c),s&&R()))},createKeySession:function(e,t,r,a){if(!i||!s||!o)throw new Error("Can not create sessions until you have selected a key system");var c=null;if(o.ksConfiguration.videoCapabilities&&o.ksConfiguration.videoCapabilities.length>0&&(c=o.ksConfiguration.videoCapabilities[0]),null===c&&o.ksConfiguration.audioCapabilities&&o.ksConfiguration.audioCapabilities.length>0&&(c=o.ksConfiguration.audioCapabilities[0]),null===c)throw new Error("Can not create sessions for unknown content types.");var E=c.contentType,l=s.createSession(E,new Uint8Array(e),a?new Uint8Array(a):null),g=function(e,t){return{session:e,initData:t,getSessionID:function(){return this.session.sessionId},getExpirationTime:function(){return NaN},getSessionType:function(){return"temporary"},handleEvent:function(e){switch(e.type){case _.error:d.trigger(S.KEY_ERROR,{error:new y.a(f.MEDIA_KEYERR_CODE,"KeyError",this)});break;case _.message:var t=ArrayBuffer.isView(e.message)?e.message.buffer:e.message;d.trigger(S.INTERNAL_KEY_MESSAGE,{data:new se(this,t,e.destinationURL)});break;case _.ready:n.debug("DRM: Key added."),d.trigger(S.KEY_ADDED);break;case _.close:n.debug("DRM: Session closed.  SessionID = "+this.getSessionID()),d.trigger(S.KEY_SESSION_CLOSED,{data:this.getSessionID()})}}}}(l,e);l.addEventListener(_.error,g),l.addEventListener(_.message,g),l.addEventListener(_.ready,g),l.addEventListener(_.close,g),u.push(g),n.debug("DRM: Session created.  SessionID = "+g.getSessionID()),d.trigger(S.KEY_SESSION_CREATED,{data:g})},updateKeySession:function(e,t){var n=e.session;E.isClearKey(i)?n.update(new Uint8Array(t.toJWK())):n.update(new Uint8Array(t)),d.trigger(S.KEY_SESSION_UPDATED)},closeKeySession:p,setServerCertificate:function(){},loadKeySession:function(){},removeKeySession:function(){},stop:h,reset:h},n=g.getLogger(t),r=null,i=null,s=null,o=null,u=[],E=Q(l).getInstance(),c={handleEvent:function(e){switch(e.type){case _.needkey:if(e.initData){var t=ArrayBuffer.isView(e.initData)?e.initData.buffer:e.initData;d.trigger(S.NEED_KEY,{key:new ie(t,"cenc")})}}}},t}ce.__dashjs_factory_name="ProtectionModel_3Feb2014";var Ee=dashjs.FactoryMaker.getClassFactory(ce);function le(e){e=e||{};var t,n,r,i,s,o,u,c,E,l=this.context,d=e.eventBus,S=e.events,g=e.debug,_=e.api,h=e.errHandler;function p(){r&&v();for(var e=0;e<u.length;e++)R(u[e]);d.trigger(S.TEARDOWN_COMPLETE)}function R(e){try{r[_.cancelKeyRequest](i.systemString,e.sessionID)}catch(t){d.trigger(S.KEY_SESSION_CLOSED,{data:null,error:"Error closing session ("+e.sessionID+") "+t.message})}}function m(e,t){if(t&&e){for(var n=e.length,r=0;r<n;r++)if(e[r].sessionID==t)return e[r];return null}return null}function v(){r.removeEventListener(_.keyerror,E),r.removeEventListener(_.needkey,E),r.removeEventListener(_.keymessage,E),r.removeEventListener(_.keyadded,E)}return t={getAllInitData:function(){for(var e=[],t=0;t<o.length;t++)e.push(o[t].initData);for(var n=0;n<u.length;n++)e.push(u[n].initData);return e},requestKeySystemAccess:function(e){var t=r;t||(t=document.createElement("video"));for(var n=!1,i=0;i<e.length;i++)for(var o=e[i].ks.systemString,u=e[i].configs,c=null,E=0;E<u.length;E++){var l=u[E].videoCapabilities;if(l&&0!==l.length){c=[];for(var f=0;f<l.length;f++)""!==t.canPlayType(l[f].contentType,o)&&c.push(l[f])}if(c&&(!c||0!==c.length)){n=!0;var y=new a(null,c),g=s.getKeySystemBySystemString(o);d.trigger(S.KEY_SYSTEM_ACCESS_COMPLETE,{data:new ae(g,y)});break}}n||d.trigger(S.KEY_SYSTEM_ACCESS_COMPLETE,{error:"Key system access denied! -- No valid audio/video content configurations detected!"})},getKeySystem:function(){return i},selectKeySystem:function(e){i=e.keySystem,d.trigger(S.INTERNAL_KEY_SYSTEM_SELECTED)},setMediaElement:function(e){if(r!==e){if(r){v();for(var t=0;t<u.length;t++)R(u[t]);u=[]}(r=e)&&(r.addEventListener(_.keyerror,E),r.addEventListener(_.needkey,E),r.addEventListener(_.keymessage,E),r.addEventListener(_.keyadded,E),d.trigger(S.VIDEO_ELEMENT_SELECTED))}},createKeySession:function(e){if(!i)throw new Error("Can not create sessions until you have selected a key system");if(c||0===u.length){var t={sessionID:null,initData:e,getSessionID:function(){return this.sessionID},getExpirationTime:function(){return NaN},getSessionType:function(){return"temporary"}};return o.push(t),r[_.generateKeyRequest](i.systemString,new Uint8Array(e)),t}throw new Error("Multiple sessions not allowed!")},updateKeySession:function(e,t){var n=e.sessionID;if(s.isClearKey(i))for(var a=0;a<t.keyPairs.length;a++)r[_.addKey](i.systemString,t.keyPairs[a].key,t.keyPairs[a].keyID,n);else r[_.addKey](i.systemString,new Uint8Array(t),new Uint8Array(e.initData),n);d.trigger(S.KEY_SESSION_UPDATED)},closeKeySession:R,setServerCertificate:function(){},loadKeySession:function(){},removeKeySession:function(){},stop:p,reset:p},n=g.getLogger(t),r=null,i=null,o=[],u=[],s=Q(l).getInstance(),E={handleEvent:function(e){var t=null;switch(e.type){case _.needkey:var r=ArrayBuffer.isView(e.initData)?e.initData.buffer:e.initData;d.trigger(S.NEED_KEY,{key:new ie(r,"cenc")});break;case _.keyerror:if((t=m(u,e.sessionId))||(t=m(o,e.sessionId)),t){var i=f.MEDIA_KEYERR_CODE,s="";switch(e.errorCode.code){case 1:i=f.MEDIA_KEYERR_UNKNOWN_CODE,s+="MEDIA_KEYERR_UNKNOWN - "+f.MEDIA_KEYERR_UNKNOWN_MESSAGE;break;case 2:i=f.MEDIA_KEYERR_CLIENT_CODE,s+="MEDIA_KEYERR_CLIENT - "+f.MEDIA_KEYERR_CLIENT_MESSAGE;break;case 3:i=f.MEDIA_KEYERR_SERVICE_CODE,s+="MEDIA_KEYERR_SERVICE - "+f.MEDIA_KEYERR_SERVICE_MESSAGE;break;case 4:i=f.MEDIA_KEYERR_OUTPUT_CODE,s+="MEDIA_KEYERR_OUTPUT - "+f.MEDIA_KEYERR_OUTPUT_MESSAGE;break;case 5:i=f.MEDIA_KEYERR_HARDWARECHANGE_CODE,s+="MEDIA_KEYERR_HARDWARECHANGE - "+f.MEDIA_KEYERR_HARDWARECHANGE_MESSAGE;break;case 6:i=f.MEDIA_KEYERR_DOMAIN_CODE,s+="MEDIA_KEYERR_DOMAIN - "+f.MEDIA_KEYERR_DOMAIN_MESSAGE}s+="  System Code = "+e.systemCode,d.trigger(S.KEY_ERROR,{error:new y.a(i,s,t)})}else n.error("No session token found for key error");break;case _.keyadded:(t=m(u,e.sessionId))||(t=m(o,e.sessionId)),t?(n.debug("DRM: Key added."),d.trigger(S.KEY_ADDED,{data:t})):n.debug("No session token found for key added");break;case _.keymessage:if((c=null!==e.sessionId&&void 0!==e.sessionId)?!(t=m(u,e.sessionId))&&o.length>0&&(t=o.shift(),u.push(t),t.sessionID=e.sessionId,d.trigger(S.KEY_SESSION_CREATED,{data:t})):o.length>0&&(t=o.shift(),u.push(t),0!==o.length&&h.error(new y.a(f.MEDIA_KEY_MESSAGE_ERROR_CODE,f.MEDIA_KEY_MESSAGE_ERROR_MESSAGE))),t){var a=ArrayBuffer.isView(e.message)?e.message.buffer:e.message;t.keyMessage=a,d.trigger(S.INTERNAL_KEY_MESSAGE,{data:new se(t,a,e.defaultURL)})}else n.warn("No session token found for key message")}}},t}le.__dashjs_factory_name="ProtectionModel_01b";var fe=dashjs.FactoryMaker.getClassFactory(le),ye=[{generateKeyRequest:"generateKeyRequest",addKey:"addKey",cancelKeyRequest:"cancelKeyRequest",needkey:"needkey",keyerror:"keyerror",keyadded:"keyadded",keymessage:"keymessage"},{generateKeyRequest:"webkitGenerateKeyRequest",addKey:"webkitAddKey",cancelKeyRequest:"webkitCancelKeyRequest",needkey:"webkitneedkey",keyerror:"webkitkeyerror",keyadded:"webkitkeyadded",keymessage:"webkitkeymessage"}],de=[{setMediaKeys:"setMediaKeys",MediaKeys:"MediaKeys",release:"close",needkey:"needkey",error:"keyerror",message:"keymessage",ready:"keyadded",close:"keyclose"},{setMediaKeys:"msSetMediaKeys",MediaKeys:"MSMediaKeys",release:"close",needkey:"msneedkey",error:"mskeyerror",message:"mskeymessage",ready:"mskeyadded",close:"mskeyclose"}];function Se(){var e,t=this.context;function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];if("function"==typeof e[r[Object.keys(r)[0]]])return r}return null}return e={createProtectionSystem:function(r){var i=null,s=Q(t).getInstance();s.setConfig({debug:r.debug,BASE64:r.BASE64}),s.initialize();var a=function(r){var i=r.debug,s=i.getLogger(e),a=r.eventBus,o=r.errHandler,u=r.videoModel?r.videoModel.getElement():null;return u&&void 0===u.onencrypted||u&&void 0===u.mediaKeys?n(u,de)?(s.info("EME detected on this user agent! (ProtectionModel_3Feb2014)"),Ee(t).create({debug:i,eventBus:a,events:r.events,api:n(u,de)})):n(u,ye)?(s.info("EME detected on this user agent! (ProtectionModel_01b)"),fe(t).create({debug:i,eventBus:a,errHandler:o,events:r.events,api:n(u,ye)})):(s.warn("No supported version of EME detected on this user agent! - Attempts to play encrypted content will fail!"),null):(s.info("EME detected on this user agent! (ProtectionModel_21Jan2015)"),ue(t).create({debug:i,eventBus:a,events:r.events}))}(r);return!i&&a&&(i=m(t).create({protectionModel:a,protectionKeyController:s,eventBus:r.eventBus,debug:r.debug,events:r.events,BASE64:r.BASE64,constants:r.constants,cmcdModel:r.cmcdModel,settings:r.settings}),r.capabilities.setEncryptedMediaSupported(!0)),i}}}Se.__dashjs_factory_name="Protection";var ge=dashjs.FactoryMaker.getClassFactory(Se);ge.events=re,ge.errors=f,dashjs.FactoryMaker.updateClassFactory(Se.__dashjs_factory_name,ge);t.default=ge},8:function(e,t,n){"use strict";t.a=function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.code=t||null,this.message=n||null,this.data=r||null}}}).default}));
//# sourceMappingURL=dash.protection.min.js.map